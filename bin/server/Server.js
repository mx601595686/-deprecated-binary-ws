"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const WS = require("ws");
const events = require("events");
const http = require("http");
const https = require("https");
const Socket_1 = require("./Socket");
class Server extends events.EventEmitter {
    constructor(...args) {
        super();
        /**
         * 保存所有客户端连接。key是socket.id
         */
        this.clients = new Map();
        const config = {
            host: '0.0.0.0',
            port: 8080,
            verifyClient: (info, cb) => {
                this.verifyClient(info.req, info.origin, info.secure).then((result => {
                    if (typeof result === 'boolean') {
                        cb(result);
                    }
                    else {
                        cb(result.res, result.code, result.message);
                    }
                }));
            }
        };
        if (args[0] instanceof http.Server || args[0] instanceof https.Server) {
            config.server = args[0];
            config.host = undefined; //必须清除，否则WS内部会另外创建一个http server
            config.port = undefined;
        }
        else if (typeof args[0] === 'number') {
            config.port = args[0];
        }
        else if (typeof args[0] === 'string') {
            config.host = args[0];
            if (typeof args[1] === 'number')
                config.port = args[1];
        }
        else if (typeof args[0] === 'object') {
            Object.assign(config, args[0]);
        }
        this._ws = new WS.Server(config);
        this._ws.on('error', this.emit.bind(this, 'error'));
        this._ws.on('listening', this.emit.bind(this, 'listening'));
        this._ws.on('connection', (client) => {
            const socket = new Socket_1.Socket(client);
            this.clients.set(socket.id, socket);
            this.emit('connection', socket);
            socket.on('close', () => {
                this.clients.delete(socket.id);
            });
        });
    }
    /**
     * 判断是否接受新的连接。
     * 返回true表示接受，返回false表示拒绝。也可以返回一个对象，提供更多信息。
     *
     * 返回对象：
     *      res {Boolean} Whether or not to accept the handshake.
     *      code {Number} When result is false this field determines the HTTP error status code to be sent to the client.
     *      name {String} When result is false this field determines the HTTP reason phrase.
     *
     * @param {string} origin The value in the Origin header indicated by the client.
     * @param {boolean} secure 'true' if req.connection.authorized or req.connection.encrypted is set.
     * @param {http.IncomingMessage} req The client HTTP GET request.
     * @returns {Promise<boolean | { res: boolean, code?: number, message?: string }>}
     * @memberof Server
     */
    verifyClient(req, origin, secure) {
        return Promise.resolve(true);
    }
    /**
     * 关闭服务器，并断开所有的客户端连接
     *
     * @returns {void}
     * @memberof Server
     */
    close() {
        this._ws.close(err => {
            this.emit('close', err);
        });
    }
    on(event, listener) {
        super.on(event, listener);
        return this;
    }
    addListener(event, listener) {
        super.addListener(event, listener);
        return this;
    }
    once(event, listener) {
        super.once(event, listener);
        return this;
    }
}
exports.Server = Server;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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O0lBQ2hCLENBQUM7SUFZRCxJQUFJLENBQUMsS0FBYSxFQUFFLFFBQWtCO1FBQ2xDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDaEIsQ0FBQztDQUNKO0FBM0tELHdCQTJLQyIsImZpbGUiOiJzZXJ2ZXIvU2VydmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgV1MgZnJvbSAnd3MnO1xyXG5pbXBvcnQgKiBhcyBldmVudHMgZnJvbSAnZXZlbnRzJztcclxuaW1wb3J0ICogYXMgaHR0cCBmcm9tICdodHRwJztcclxuaW1wb3J0ICogYXMgaHR0cHMgZnJvbSAnaHR0cHMnO1xyXG5pbXBvcnQgeyBTZXJ2ZXJDb25maWcgfSBmcm9tICcuL1NlcnZlckNvbmZpZyc7XHJcbmltcG9ydCB7IFNvY2tldCB9IGZyb20gJy4vU29ja2V0JztcclxuXHJcbmV4cG9ydCBjbGFzcyBTZXJ2ZXIgZXh0ZW5kcyBldmVudHMuRXZlbnRFbWl0dGVyIHtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOiiq+WMheijheeahHdlYnNvY2tldOWvueixoVxyXG4gICAgICogXHJcbiAgICAgKiBAdHlwZSB7V1MuU2VydmVyfVxyXG4gICAgICogQG1lbWJlcm9mIFNlcnZlclxyXG4gICAgICovXHJcbiAgICByZWFkb25seSBfd3M6IFdTLlNlcnZlcjtcclxuXHJcbiAgICAvKipcclxuICAgICAqIOS/neWtmOaJgOacieWuouaIt+err+i/nuaOpeOAgmtleeaYr3NvY2tldC5pZFxyXG4gICAgICovXHJcbiAgICByZWFkb25seSBjbGllbnRzOiBNYXA8bnVtYmVyLCBTb2NrZXQ+ID0gbmV3IE1hcCgpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu6d2Vic29ja2V05pyN5Yqh5Zmo44CCXHJcbiAgICAgKiBAbWVtYmVyb2YgU2VydmVyXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKClcclxuICAgIC8qKlxyXG4gICAgICog5Yib5bu6d2Vic29ja2V05pyN5Yqh5Zmo44CCXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaG9zdCDnm5HlkKznmoTlnLDlnYBcclxuICAgICAqIEBtZW1iZXJvZiBTZXJ2ZXJcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoaG9zdDogc3RyaW5nKVxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7p3ZWJzb2NrZXTmnI3liqHlmajjgIJcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBwb3J0IOebkeWQrOeahOerr+WPo1xyXG4gICAgICogQG1lbWJlcm9mIFNlcnZlclxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3Rvcihwb3J0OiBudW1iZXIpXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7undlYnNvY2tldOacjeWKoeWZqOOAglxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGhvc3Qg55uR5ZCs55qE5Zyw5Z2AXHJcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gcG9ydCDnm5HlkKznmoTnq6/lj6NcclxuICAgICAqIEBtZW1iZXJvZiBTZXJ2ZXJcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoaG9zdDogc3RyaW5nLCBwb3J0OiBudW1iZXIpXHJcbiAgICAvKipcclxuICAgICAqIOWIm+W7undlYnNvY2tldOacjeWKoeWZqOOAglxyXG4gICAgICogQHBhcmFtIHsoaHR0cC5TZXJ2ZXIgfCBodHRwcy5TZXJ2ZXIpfSBzZXJ2ZXIg57uR5a6a5Yiw6L+Z5LiqaHR0cOacjeWKoeWZqOS5i+S4ilxyXG4gICAgICogQG1lbWJlcm9mIFNlcnZlclxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihzZXJ2ZXI6IGh0dHAuU2VydmVyIHwgaHR0cHMuU2VydmVyKVxyXG4gICAgLyoqXHJcbiAgICAgKiDliJvlu7p3ZWJzb2NrZXTmnI3liqHlmajjgIJcclxuICAgICAqIEBwYXJhbSB7U2VydmVyQ29uZmlnfSBvcHRpb25zIOacjeWKoeWZqOmFjee9rlxyXG4gICAgICogQG1lbWJlcm9mIFNlcnZlclxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBTZXJ2ZXJDb25maWcpXHJcbiAgICBjb25zdHJ1Y3RvciguLi5hcmdzOiBhbnlbXSkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbmZpZzogU2VydmVyQ29uZmlnICYgeyB2ZXJpZnlDbGllbnQ6IFdTLlZlcmlmeUNsaWVudENhbGxiYWNrQXN5bmMgfSA9IHtcclxuICAgICAgICAgICAgaG9zdDogJzAuMC4wLjAnLFxyXG4gICAgICAgICAgICBwb3J0OiA4MDgwLFxyXG4gICAgICAgICAgICB2ZXJpZnlDbGllbnQ6IChpbmZvLCBjYikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52ZXJpZnlDbGllbnQoaW5mby5yZXEsIGluZm8ub3JpZ2luLCBpbmZvLnNlY3VyZSkudGhlbigocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNiKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2IocmVzdWx0LnJlcywgcmVzdWx0LmNvZGUsIHJlc3VsdC5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoYXJnc1swXSBpbnN0YW5jZW9mICg8YW55Pmh0dHApLlNlcnZlciB8fCBhcmdzWzBdIGluc3RhbmNlb2YgKDxhbnk+aHR0cHMpLlNlcnZlcikge1xyXG4gICAgICAgICAgICBjb25maWcuc2VydmVyID0gYXJnc1swXTtcclxuICAgICAgICAgICAgY29uZmlnLmhvc3QgPSB1bmRlZmluZWQ7ICAgIC8v5b+F6aG75riF6Zmk77yM5ZCm5YiZV1PlhoXpg6jkvJrlj6blpJbliJvlu7rkuIDkuKpodHRwIHNlcnZlclxyXG4gICAgICAgICAgICBjb25maWcucG9ydCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICBjb25maWcucG9ydCA9IGFyZ3NbMF07XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgY29uZmlnLmhvc3QgPSBhcmdzWzBdO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGFyZ3NbMV0gPT09ICdudW1iZXInKVxyXG4gICAgICAgICAgICAgICAgY29uZmlnLnBvcnQgPSBhcmdzWzFdO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oY29uZmlnLCBhcmdzWzBdKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX3dzID0gbmV3IFdTLlNlcnZlcihjb25maWcpO1xyXG4gICAgICAgIHRoaXMuX3dzLm9uKCdlcnJvcicsIHRoaXMuZW1pdC5iaW5kKHRoaXMsICdlcnJvcicpKTtcclxuICAgICAgICB0aGlzLl93cy5vbignbGlzdGVuaW5nJywgdGhpcy5lbWl0LmJpbmQodGhpcywgJ2xpc3RlbmluZycpKTtcclxuICAgICAgICB0aGlzLl93cy5vbignY29ubmVjdGlvbicsIChjbGllbnQpID0+IHtcclxuICAgICAgICAgICAgY29uc3Qgc29ja2V0ID0gbmV3IFNvY2tldChjbGllbnQpO1xyXG4gICAgICAgICAgICB0aGlzLmNsaWVudHMuc2V0KHNvY2tldC5pZCwgc29ja2V0KTtcclxuICAgICAgICAgICAgdGhpcy5lbWl0KCdjb25uZWN0aW9uJywgc29ja2V0KTtcclxuXHJcbiAgICAgICAgICAgIHNvY2tldC5vbignY2xvc2UnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudHMuZGVsZXRlKHNvY2tldC5pZCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Yik5pat5piv5ZCm5o6l5Y+X5paw55qE6L+e5o6l44CCICAgIFxyXG4gICAgICog6L+U5ZuedHJ1ZeihqOekuuaOpeWPl++8jOi/lOWbnmZhbHNl6KGo56S65ouS57ud44CC5Lmf5Y+v5Lul6L+U5Zue5LiA5Liq5a+56LGh77yM5o+Q5L6b5pu05aSa5L+h5oGv44CCICBcclxuICAgICAqICBcclxuICAgICAqIOi/lOWbnuWvueixoe+8miAgICBcclxuICAgICAqICAgICAgcmVzIHtCb29sZWFufSBXaGV0aGVyIG9yIG5vdCB0byBhY2NlcHQgdGhlIGhhbmRzaGFrZS4gICBcclxuICAgICAqICAgICAgY29kZSB7TnVtYmVyfSBXaGVuIHJlc3VsdCBpcyBmYWxzZSB0aGlzIGZpZWxkIGRldGVybWluZXMgdGhlIEhUVFAgZXJyb3Igc3RhdHVzIGNvZGUgdG8gYmUgc2VudCB0byB0aGUgY2xpZW50LiAgIFxyXG4gICAgICogICAgICBuYW1lIHtTdHJpbmd9IFdoZW4gcmVzdWx0IGlzIGZhbHNlIHRoaXMgZmllbGQgZGV0ZXJtaW5lcyB0aGUgSFRUUCByZWFzb24gcGhyYXNlLiAgIFxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gb3JpZ2luIFRoZSB2YWx1ZSBpbiB0aGUgT3JpZ2luIGhlYWRlciBpbmRpY2F0ZWQgYnkgdGhlIGNsaWVudC5cclxuICAgICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2VjdXJlICd0cnVlJyBpZiByZXEuY29ubmVjdGlvbi5hdXRob3JpemVkIG9yIHJlcS5jb25uZWN0aW9uLmVuY3J5cHRlZCBpcyBzZXQuXHJcbiAgICAgKiBAcGFyYW0ge2h0dHAuSW5jb21pbmdNZXNzYWdlfSByZXEgVGhlIGNsaWVudCBIVFRQIEdFVCByZXF1ZXN0LlxyXG4gICAgICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbiB8IHsgcmVzOiBib29sZWFuLCBjb2RlPzogbnVtYmVyLCBtZXNzYWdlPzogc3RyaW5nIH0+fSBcclxuICAgICAqIEBtZW1iZXJvZiBTZXJ2ZXJcclxuICAgICAqL1xyXG4gICAgdmVyaWZ5Q2xpZW50KHJlcTogaHR0cC5JbmNvbWluZ01lc3NhZ2UsIG9yaWdpbjogc3RyaW5nLCBzZWN1cmU6IGJvb2xlYW4pOiBQcm9taXNlPGJvb2xlYW4gfCB7IHJlczogYm9vbGVhbiwgY29kZT86IG51bWJlciwgbWVzc2FnZT86IHN0cmluZyB9PiB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWFs+mXreacjeWKoeWZqO+8jOW5tuaWreW8gOaJgOacieeahOWuouaIt+err+i/nuaOpVxyXG4gICAgICogXHJcbiAgICAgKiBAcmV0dXJucyB7dm9pZH0gXHJcbiAgICAgKiBAbWVtYmVyb2YgU2VydmVyXHJcbiAgICAgKi9cclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIHRoaXMuX3dzLmNsb3NlKGVyciA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZW1pdCgnY2xvc2UnLCBlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uKGV2ZW50OiAnZXJyb3InLCBjYjogKGVycjogRXJyb3IpID0+IHZvaWQpOiB0aGlzXHJcbiAgICAvKipcclxuICAgICAqIOW9k+acjeWKoeWZqOW8gOWni+ebkeWQrFxyXG4gICAgICovXHJcbiAgICBvbihldmVudDogJ2xpc3RlbmluZycsIGNiOiAoKSA9PiB2b2lkKTogdGhpc1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPmnInmlrDnmoTlrqLmiLfnq6/kuI7mnI3liqHlmajlu7rnq4votbfov57mjqVcclxuICAgICAqL1xyXG4gICAgb24oZXZlbnQ6ICdjb25uZWN0aW9uJywgY2I6IChzb2NrZXQ6IFNvY2tldCkgPT4gdm9pZCk6IHRoaXNcclxuICAgIG9uKGV2ZW50OiAnY2xvc2UnLCBjYjogKGVycjogRXJyb3IpID0+IHZvaWQpOiB0aGlzXHJcbiAgICBvbihldmVudDogc3RyaW5nLCBsaXN0ZW5lcjogRnVuY3Rpb24pOiB0aGlzIHtcclxuICAgICAgICBzdXBlci5vbihldmVudCwgbGlzdGVuZXIpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZExpc3RlbmVyKGV2ZW50OiAnZXJyb3InLCBjYjogKGVycjogRXJyb3IpID0+IHZvaWQpOiB0aGlzXHJcbiAgICAvKipcclxuICAgICAqIOW9k+acjeWKoeWZqOW8gOWni+ebkeWQrFxyXG4gICAgICovXHJcbiAgICBhZGRMaXN0ZW5lcihldmVudDogJ2xpc3RlbmluZycsIGNiOiAoKSA9PiB2b2lkKTogdGhpc1xyXG4gICAgLyoqXHJcbiAgICAgKiDlvZPmnInmlrDnmoTlrqLmiLfnq6/kuI7mnI3liqHlmajlu7rnq4votbfov57mjqVcclxuICAgICAqL1xyXG4gICAgYWRkTGlzdGVuZXIoZXZlbnQ6ICdjb25uZWN0aW9uJywgY2I6IChzb2NrZXQ6IFNvY2tldCkgPT4gdm9pZCk6IHRoaXNcclxuICAgIGFkZExpc3RlbmVyKGV2ZW50OiAnY2xvc2UnLCBjYjogKGVycjogRXJyb3IpID0+IHZvaWQpOiB0aGlzXHJcbiAgICBhZGRMaXN0ZW5lcihldmVudDogc3RyaW5nLCBsaXN0ZW5lcjogRnVuY3Rpb24pOiB0aGlzIHtcclxuICAgICAgICBzdXBlci5hZGRMaXN0ZW5lcihldmVudCwgbGlzdGVuZXIpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIG9uY2UoZXZlbnQ6ICdlcnJvcicsIGNiOiAoZXJyOiBFcnJvcikgPT4gdm9pZCk6IHRoaXNcclxuICAgIC8qKlxyXG4gICAgICog5b2T5pyN5Yqh5Zmo5byA5aeL55uR5ZCsXHJcbiAgICAgKi9cclxuICAgIG9uY2UoZXZlbnQ6ICdsaXN0ZW5pbmcnLCBjYjogKCkgPT4gdm9pZCk6IHRoaXNcclxuICAgIC8qKlxyXG4gICAgICog5b2T5pyJ5paw55qE5a6i5oi356uv5LiO5pyN5Yqh5Zmo5bu656uL6LW36L+e5o6lXHJcbiAgICAgKi9cclxuICAgIG9uY2UoZXZlbnQ6ICdjb25uZWN0aW9uJywgY2I6IChzb2NrZXQ6IFNvY2tldCkgPT4gdm9pZCk6IHRoaXNcclxuICAgIG9uY2UoZXZlbnQ6ICdjbG9zZScsIGNiOiAoZXJyOiBFcnJvcikgPT4gdm9pZCk6IHRoaXNcclxuICAgIG9uY2UoZXZlbnQ6IHN0cmluZywgbGlzdGVuZXI6IEZ1bmN0aW9uKTogdGhpcyB7XHJcbiAgICAgICAgc3VwZXIub25jZShldmVudCwgbGlzdGVuZXIpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59Il19
